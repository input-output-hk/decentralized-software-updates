\section{The Activation of Changes}
We have seen that upon the approval of a UP, users start installing the software update (i.e., upgrade) and wait for the activation of the changes. We call the time period from the approval of a UP until the actual activation of the changes in the blockchain system as the \emph{activation lag}. In order, to enable a fast and flexible software updating mechanism, we should minimize the activation lag, which is in turn determined by the \emph{adoption threshold}.

\subsection{The Adoption Threshold}
%In the lifecycle section, we have described how a software update, after being voted as a SIP, it is submitted again during the approval phase in the form of a UP (source code bundled with metadata), in order to be approved. We make the assumption 
In our protocol, we assume that if a UP is approved, then all (honest) stake will eventually upgrade. However, if we want to have a minimum activation lag, then we cannot wait until all the stake upgrades to kick-off activation. What is the minimum necessary percent of stake to have upgraded, before the actual activation of the change takes place, in order to avoid a chain split? The \emph{adoption threshold} is used in the activation phase and corresponds exactly to the minimum percent of stake that is necessary to have signaled activation readiness, before the actual activation of a software update takes place. It is essentially a synchronization point that ensures that a sufficient percent of stake has upgraded and thus it is safe to actually activate the changes. It is therefore a guard against chain splits. Please note that the adoption threshold is only relevant for software updates that impact the consensus protocol. For all other software updates the activation can take place immediately after the upgrade.

Let us assume that the adoption threshold of our software updates protocol is called $\tau_A$. %In order to enable update policies, we need to be able to adjust $\tau_A$ based on each software update's metadata. 
What would be the appropriate values for $\tau_A$? Take into account that by adjusting the value of $\tau_A$, we risk to cause a chain split for two distinct reasons: a) A too-low value of $\tau_A$ might result to a \emph{too-early activation}, which will result to the partition of the honest stake in two and a potential chain split\footnote{A partition of the honest stake also undermines the security of the underlying consensus protocol which assumes a minimum threshold $x$ of honest stake.}  and b) a too-high value of $\tau_A$ might result to a \emph{too-late activation}, giving the opportunity to adversaries to block an activation by refusing to signal. We call this a \emph{Denial of Activation} attack. %Clearly the former is a safety problem, while the latter is a security problem. 
What is the allowable range of values for $\tau_A$, in order to mitigate these risks?

In order to avoid both of the two problems described above, the adoption threshold $\tau_A$ should take values in the range $x \leq \tau_A \leq h_a$, where $x$ is the theoretical honest stake threshold of the underlying consensus protocol and $h_a$ is the \emph{actual} percent of honest stake (of course $h_a \geq x$). In addition, we assume that the honest stake that has signaled, when the threshold is met, is at least $x$ ($S_{honest} \geq x$) , i.e., at least equal to the honest stake threshold of the consensus protocol. The rationale of this result is explained in the appendix, due to space limitations.

A possible attack in the case where $x \leq \tau_A \leq h_a$ is the adversary to hurry to signal for a software update, so that the threshold $\tau_A$ is met, without (at least) $x$ honest stake to have enough time to complete the upgrade (i.e., $S_{honest} < x$). Thus a too-early activation will take place and the honest stake will be partitioned for some time, risking a chain split and also running the consensus protocol without the $x$ honest stake assumption.

Intuitively, in order to prevent this type of attack, we need to give more time to honest stake to upgrade, since we have assumed that all honest stake will eventually upgrade. This is especially true for difficult to deploy software updates, or hard fork type of changes, where the risk of a chain split is greater. A high value of $\tau_A$ would help towards this end, which means that our update policy, would ideally adjust the adoption threshold close to $h_a$ (i.e., to the actual percent of honest stake). Of course, we do not know $h_a$ exactly and we should base it on some sort of estimation. What if we could delay the activation of changes, even though the $\tau_A$ threshold has been met? This is the topic of the next subsection. 

\subsubsection{The Safety Lag}
To mitigate the risk of a too-early activation, %either \say{by-accident} or by-attack, 
we propose the concept of the \emph{safety lag}. The safety lag is a metadata-driven artificial delay, which is imposed on the activation of a change, in order to give time to the honest stake to upgrade and thus protect against a too-early activation. In other words, even though  the adoption threshold of signals might be met, the activation of the changes does not take place, it is stalled, until the safety lag period passes.

The safety lag is determined by two things: a) the deployment complexity of a software update and b) the type of the consensus protocol change (soft/hard fork\footnote{Velvet forks \cite{velvet} do not impact the consensus by causing forks and thus can activate immediately after an upgrade.}).
For example, there might be software updates that entail a very complex deployment process; one that even maybe a hardware upgrade is required before the software upgrade. In such a case, the activation lag must ensure plenty of time to the stakeholders to upgrade. Similarly, a hard fork type of change, should trigger a greater activation lag than that of a soft fork type of change. 
We propose both of these to be recorded as important characteristics of a decentralized software update's metadata. This information will drive the choice of the length of the activation lag and enable a metadata-driven update policy. Of course, these metadata have been approved for their correctness by the stake majority in the Ideation phase.
